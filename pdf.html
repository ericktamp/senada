<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyPDF - Personal Document Suite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; }
        .glass { background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(10px); }
        .tool-card:hover .icon-box { transform: scale(1.1) rotate(-5deg); }
    </style>
</head>
<body class="bg-[#f8fafc] text-slate-900 min-h-screen">

    <nav class="glass sticky top-0 z-50 border-b border-slate-200 px-6 py-4">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-2 cursor-pointer" onclick="hideTool()">
                <div class="bg-indigo-600 p-2 rounded-xl text-white shadow-lg shadow-indigo-200">
                    <i data-lucide="file-text" class="w-6 h-6"></i>
                </div>
                <span class="text-xl font-bold tracking-tight text-slate-800">My<span class="text-indigo-600">PDF</span></span>
            </div>
            <div class="text-sm font-semibold text-slate-400 bg-slate-100 px-4 py-1.5 rounded-full">
                Created by BlaBluBle
            </div>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto px-6 py-12">
        
        <div id="hero-text" class="text-center mb-16">
            <h1 class="text-4xl md:text-5xl font-extrabold mb-4 text-slate-900">Apa yang ingin kamu kerjakan hari ini?</h1>
            <p class="text-slate-500 text-lg">Alat pengolah dokumen pribadi, cepat, dan 100% aman di browsermu. Sekarang dengan lebih banyak fitur!</p>
        </div>

        <div id="main-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            
            <div onclick="showTool('Images to PDF', 'image/*')" class="tool-card group bg-white p-8 rounded-3xl shadow-sm border border-slate-100 cursor-pointer hover:shadow-xl hover:border-indigo-100 transition-all duration-300">
                <div class="icon-box bg-indigo-50 w-16 h-16 rounded-2xl flex items-center justify-center mb-6 transition-all duration-300">
                    <i data-lucide="image-plus" class="w-8 h-8 text-indigo-600"></i>
                </div>
                <h3 class="text-xl font-bold mb-2">Foto ke PDF</h3>
                <p class="text-slate-500 text-sm leading-relaxed">Ubah koleksi foto (JPG/PNG) menjadi satu file PDF rapi untuk dikirim atau diprint.</p>
            </div>

            <div onclick="showTool('Merge PDF', '.pdf')" class="tool-card group bg-white p-8 rounded-3xl shadow-sm border border-slate-100 cursor-pointer hover:shadow-xl hover:border-red-100 transition-all duration-300">
                <div class="icon-box bg-red-50 w-16 h-16 rounded-2xl flex items-center justify-center mb-6 transition-all duration-300">
                    <i data-lucide="layers" class="w-8 h-8 text-red-600"></i>
                </div>
                <h3 class="text-xl font-bold mb-2">Gabungkan PDF</h3>
                <p class="text-slate-500 text-sm leading-relaxed">Satukan beberapa file PDF hasil scan menjadi satu urutan yang benar.</p>
            </div>

            <div onclick="showTool('Compress PDF', '.pdf')" class="tool-card group bg-white p-8 rounded-3xl shadow-sm border border-slate-100 cursor-pointer hover:shadow-xl hover:border-emerald-100 transition-all duration-300">
                <div class="icon-box bg-emerald-50 w-16 h-16 rounded-2xl flex items-center justify-center mb-6 transition-all duration-300">
                    <i data-lucide="zap" class="w-8 h-8 text-emerald-600"></i>
                </div>
                <h3 class="text-xl font-bold mb-2">Kompres PDF</h3>
                <p class="text-slate-500 text-sm leading-relaxed">Kecilkan ukuran file PDF tanpa ribet untuk kebutuhan upload formulir.</p>
            </div>

            <div onclick="showTool('Split PDF', '.pdf')" class="tool-card group bg-white p-8 rounded-3xl shadow-sm border border-slate-100 cursor-pointer hover:shadow-xl hover:border-purple-100 transition-all duration-300">
                <div class="icon-box bg-purple-50 w-16 h-16 rounded-2xl flex items-center justify-center mb-6 transition-all duration-300">
                    <i data-lucide="scissors" class="w-8 h-8 text-purple-600"></i>
                </div>
                <h3 class="text-xl font-bold mb-2">Pisah PDF</h3>
                <p class="text-slate-500 text-sm leading-relaxed">Pisahkan PDF besar menjadi file-file kecil berdasarkan halaman yang dipilih.</p>
            </div>

            <div onclick="showTool('Rotate PDF', '.pdf')" class="tool-card group bg-white p-8 rounded-3xl shadow-sm border border-slate-100 cursor-pointer hover:shadow-xl hover:border-orange-100 transition-all duration-300">
                <div class="icon-box bg-orange-50 w-16 h-16 rounded-2xl flex items-center justify-center mb-6 transition-all duration-300">
                    <i data-lucide="rotate-cw" class="w-8 h-8 text-orange-600"></i>
                </div>
                <h3 class="text-xl font-bold mb-2">Putar Halaman PDF</h3>
                <p class="text-slate-500 text-sm leading-relaxed">Putar halaman PDF yang terbalik agar mudah dibaca.</p>
            </div>

            <div onclick="showTool('Add Watermark', '.pdf')" class="tool-card group bg-white p-8 rounded-3xl shadow-sm border border-slate-100 cursor-pointer hover:shadow-xl hover:border-blue-100 transition-all duration-300">
                <div class="icon-box bg-blue-50 w-16 h-16 rounded-2xl flex items-center justify-center mb-6 transition-all duration-300">
                    <i data-lucide="stamp" class="w-8 h-8 text-blue-600"></i>
                </div>
                <h3 class="text-xl font-bold mb-2">Tambah Watermark</h3>
                <p class="text-slate-500 text-sm leading-relaxed">Tambahkan teks watermark seperti 'CONFIDENTIAL' ke PDF-mu.</p>
            </div>

        </div>

        <div id="upload-section" class="hidden max-w-3xl mx-auto">
            <button onclick="hideTool()" class="mb-8 flex items-center text-slate-400 hover:text-indigo-600 transition font-medium">
                <i data-lucide="arrow-left" class="w-5 h-5 mr-2"></i> Kembali ke Menu Utama
            </button>
            
            <div class="bg-white p-2 rounded-[2.5rem] shadow-2xl overflow-hidden border border-slate-100">
                <div class="p-10 text-center">
                    <h2 id="tool-title" class="text-3xl font-extrabold mb-8 text-slate-800 tracking-tight">Images to PDF</h2>
                    
                    <div id="drop-area" class="border-3 border-dashed border-slate-200 rounded-[2rem] p-12 bg-slate-50 hover:bg-indigo-50/50 hover:border-indigo-200 transition-all cursor-pointer group" onclick="document.getElementById('fileInput').click()">
                        <div class="bg-white w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6 shadow-sm group-hover:scale-110 transition-all">
                            <i data-lucide="cloud-upload" class="w-10 h-10 text-indigo-500"></i>
                        </div>
                        <p class="text-xl font-bold text-slate-700">Klik untuk pilih file</p>
                        <p class="text-slate-400 mt-2">Mendukung banyak file sekaligus</p>
                        <input type="file" id="fileInput" class="hidden" multiple>
                    </div>

                    <div id="extra-options" class="mt-6 hidden">
                        <label for="watermark-text" class="block text-left text-slate-600 font-medium mb-2">Teks Watermark (untuk Add Watermark):</label>
                        <input type="text" id="watermark-text" class="w-full p-3 border border-slate-200 rounded-xl mb-4" placeholder="Masukkan teks watermark...">

                        <label for="split-pages" class="block text-left text-slate-600 font-medium mb-2">Pisah Halaman (untuk Split PDF, pisah dengan koma):</label>
                        <input type="text" id="split-pages" class="w-full p-3 border border-slate-200 rounded-xl mb-4" placeholder="Contoh: 1,3-5">

                        <label for="rotate-angle" class="block text-left text-slate-600 font-medium mb-2">Sudut Putar (untuk Rotate PDF):</label>
                        <select id="rotate-angle" class="w-full p-3 border border-slate-200 rounded-xl mb-4">
                            <option value="90">90° Searah Jarum Jam</option>
                            <option value="180">180°</option>
                            <option value="270">270° Searah Jarum Jam</option>
                        </select>
                    </div>

                    <div id="file-preview-container" class="mt-8 hidden">
                        <div id="file-list" class="grid grid-cols-2 gap-4 text-left max-h-60 overflow-y-auto p-4 bg-slate-50 rounded-2xl border border-slate-100">
                        </div>
                        <button id="processBtn" class="w-full mt-8 bg-indigo-600 text-white py-5 rounded-2xl font-bold text-lg hover:bg-indigo-700 shadow-xl shadow-indigo-200 transition-all active:scale-[0.98] flex items-center justify-center gap-3">
                            <i data-lucide="settings-2" class="w-6 h-6"></i>
                            Mulai Proses & Download
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        lucide.createIcons();

        const mainGrid = document.getElementById('main-grid');
        const heroText = document.getElementById('hero-text');
        const uploadSection = document.getElementById('upload-section');
        const toolTitle = document.getElementById('tool-title');
        const fileInput = document.getElementById('fileInput');
        const fileList = document.getElementById('file-list');
        const previewContainer = document.getElementById('file-preview-container');
        const processBtn = document.getElementById('processBtn');
        const extraOptions = document.getElementById('extra-options');

        let currentMode = '';

        function showTool(name, accept) {
            currentMode = name;
            mainGrid.classList.add('hidden');
            heroText.classList.add('hidden');
            uploadSection.classList.remove('hidden');
            toolTitle.innerText = name;
            fileInput.accept = accept;
            extraOptions.classList.toggle('hidden', !['Split PDF', 'Rotate PDF', 'Add Watermark'].includes(name));
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function hideTool() {
            uploadSection.classList.add('hidden');
            mainGrid.classList.remove('hidden');
            heroText.classList.remove('hidden');
            fileInput.value = '';
            fileList.innerHTML = '';
            previewContainer.classList.add('hidden');
            extraOptions.classList.add('hidden');
        }

        fileInput.addEventListener('change', (e) => {
            const files = Array.from(e.target.files);
            if (files.length > 0) {
                previewContainer.classList.remove('hidden');
                fileList.innerHTML = files.map(f => `
                    <div class="flex items-center gap-3 bg-white p-3 rounded-xl border border-slate-200 shadow-sm overflow-hidden">
                        <div class="bg-indigo-100 p-2 rounded-lg"><i data-lucide="file" class="w-4 h-4 text-indigo-600"></i></div>
                        <span class="text-xs font-bold truncate">${f.name}</span>
                    </div>
                `).join('');
                lucide.createIcons();
            }
        });

        processBtn.addEventListener('click', async () => {
            const files = Array.from(fileInput.files);
            if (files.length === 0) return;

            processBtn.innerHTML = `<span class="animate-spin mr-2">⏳</span> Sedang Memproses...`;
            processBtn.disabled = true;

            try {
                const { PDFDocument, StandardFonts, rgb } = PDFLib;
                let pdfDoc = await PDFDocument.create();
                let outputPdfs = []; // Untuk fitur split, bisa multiple output

                if (currentMode === 'Images to PDF') {
                    for (const file of files) {
                        const arrayBuffer = await file.arrayBuffer();
                        let image;
                        if (file.type === "image/jpeg") {
                            image = await pdfDoc.embedJpg(arrayBuffer);
                        } else if (file.type === "image/png") {
                            image = await pdfDoc.embedPng(arrayBuffer);
                        } else { continue; }

                        const page = pdfDoc.addPage([image.width, image.height]);
                        page.drawImage(image, { x: 0, y: 0, width: image.width, height: image.height });
                    }
                } else if (currentMode === 'Merge PDF') {
                    for (const file of files) {
                        const arrayBuffer = await file.arrayBuffer();
                        const pdf = await PDFDocument.load(arrayBuffer);
                        const copiedPages = await pdfDoc.copyPages(pdf, pdf.getPageIndices());
                        copiedPages.forEach((page) => pdfDoc.addPage(page));
                    }
                } else if (currentMode === 'Compress PDF') {
                    // Compress sederhana: load PDF, remove metadata, dan save dengan linearize
                    const file = files[0]; // Asumsi single file
                    const arrayBuffer = await file.arrayBuffer();
                    pdfDoc = await PDFDocument.load(arrayBuffer);
                    pdfDoc.removePageMetadata(); // Hapus metadata untuk kurangi size
                    // Untuk compress image: butuh iterate pages dan re-embed images dengan lower quality, tapi skip dulu untuk cepat
                } else if (currentMode === 'Split PDF') {
                    const file = files[0];
                    const arrayBuffer = await file.arrayBuffer();
                    const originalPdf = await PDFDocument.load(arrayBuffer);
                    const pagesInput = document.getElementById('split-pages').value || '1'; // Default all
                    const pageRanges = pagesInput.split(',').map(range => {
                        if (range.includes('-')) {
                            const [start, end] = range.split('-').map(Number);
                            return Array.from({length: end - start + 1}, (_, i) => start + i - 1); // 0-index
                        }
                        return [Number(range) - 1];
                    }).flat();

                    const splitDoc = await PDFDocument.create();
                    const copiedPages = await splitDoc.copyPages(originalPdf, pageRanges);
                    copiedPages.forEach(page => splitDoc.addPage(page));
                    pdfDoc = splitDoc;
                } else if (currentMode === 'Rotate PDF') {
                    const file = files[0];
                    const arrayBuffer = await file.arrayBuffer();
                    pdfDoc = await PDFDocument.load(arrayBuffer);
                    const angle = parseInt(document.getElementById('rotate-angle').value) || 90;
                    pdfDoc.getPages().forEach(page => page.setRotation(page.getRotation().angle + angle));
                } else if (currentMode === 'Add Watermark') {
                    const file = files[0];
                    const arrayBuffer = await file.arrayBuffer();
                    pdfDoc = await PDFDocument.load(arrayBuffer);
                    const watermarkText = document.getElementById('watermark-text').value || 'CONFIDENTIAL';
                    const font = await pdfDoc.embedFont(StandardFonts.Helvetica);
                    const pages = pdfDoc.getPages();
                    pages.forEach(page => {
                        const { width, height } = page.getSize();
                        page.drawText(watermarkText, {
                            x: width / 2 - 50,
                            y: height / 2,
                            size: 50,
                            font,
                            color: rgb(0.5, 0.5, 0.5),
                            opacity: 0.5,
                            rotate: { type: 'degrees', angle: 45 },
                        });
                    });
                }

                const pdfBytes = await pdfDoc.save({ linearize: true }); // Optimize with linearize
                const blob = new Blob([pdfBytes], { type: 'application/pdf' });
                const url = URL.createObjectURL(blob);
                
                // Download
                const link = document.createElement('a');
                link.href = url;
                link.download = `MyPDF-${currentMode.replace(/\s/g, '')}-${Date.now()}.pdf`;
                link.click();

                // Open Print Dialog
                const printWindow = window.open(url);
                if (printWindow) {
                    printWindow.onload = () => {
                        printWindow.print();
                    };
                }

            } catch (err) {
                console.error(err);
                alert("Waduh, ada masalah pas proses filenya: " + err.message);
            } finally {
                processBtn.innerHTML = `<i data-lucide="settings-2" class="w-6 h-6"></i> Mulai Proses & Download`;
                processBtn.disabled = false;
                lucide.createIcons();
            }
        });
    </script>
</body>
</html>
